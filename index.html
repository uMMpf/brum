<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="bingbot" content="noindex, nofollow">
    <meta name="slurp" content="noindex, nofollow">
    <meta name="duckduckbot" content="noindex, nofollow">
    <meta name="baiduspider" content="noindex, nofollow">
    <meta name="yandex" content="noindex, nofollow">
    <meta name="anthropic-ai" content="noindex">
    <meta name="claudebot" content="noindex">
    <meta name="gptbot" content="noindex">
    <meta name="chatgpt-user" content="noindex">
    <meta name="ccbot" content="noindex">
    <meta name="applebot" content="noindex">
    <title>Ko≈°arka brum brum üöó</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23FF6B35' stroke='%23000' stroke-width='2'/><path d='M 50 2 Q 50 50 50 98' stroke='%23000' stroke-width='2' fill='none'/><path d='M 2 50 Q 50 50 98 50' stroke='%23000' stroke-width='2' fill='none'/><path d='M 15 15 Q 50 50 85 85' stroke='%23000' stroke-width='2' fill='none'/><path d='M 85 15 Q 50 50 15 85' stroke='%23000' stroke-width='2' fill='none'/></svg>">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase Configuration - REPLACE WITH YOUR CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        let db = null;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.database();
        } catch (error) {
            console.log("Firebase not configured yet. Using fallback localStorage.");
        }

        const CarpoolApp = () => {
            const practices = [
                { id: 'pon', day: 'Pon', time: '20:00-21:15' },
                { id: 'uto', day: 'Uto', time: '18:30-20:00' },
                { id: 'cet', day: 'ƒået', time: '18:30-20:00' },
                { id: 'pet', day: 'Pet', time: '17:00-18:30' },
                { id: 'sub', day: 'Sub', time: '13:00-14:30' }
            ];

            const children = ['Bartol', 'Ivano', 'Mak'];
            const families = ['Vlahoviƒá', '≈†ipek', 'Mariƒá'];

            // Get Monday of a given week
            const getMondayOfWeek = (date) => {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day + (day === 0 ? -6 : 1);
                return new Date(d.setDate(diff));
            };

            // Get current active week based on Saturday 15:00 rule
            const getCurrentWeekStart = () => {
                const now = new Date();
                const day = now.getDay();
                const hour = now.getHours();
                
                if (day === 6 && hour >= 15) {
                    const nextWeek = new Date(now);
                    nextWeek.setDate(now.getDate() + 2);
                    return getMondayOfWeek(nextWeek);
                }
                
                return getMondayOfWeek(now);
            };

            const formatWeekRange = (mondayDate) => {
                const monday = new Date(mondayDate);
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                
                const formatDate = (d) => {
                    return d.toLocaleDateString('hr-HR', { day: 'numeric', month: 'short', year: 'numeric' });
                };
                
                return `${formatDate(monday)} - ${formatDate(sunday)}`;
            };

            const getWeekKey = (mondayDate) => {
                return mondayDate.toISOString().split('T')[0];
            };

            const [currentWeekStart, setCurrentWeekStart] = useState(getCurrentWeekStart());
            const [selectedWeekStart, setSelectedWeekStart] = useState(getCurrentWeekStart());
            const [weekHistory, setWeekHistory] = useState({});
            const [showResults, setShowResults] = useState(false);
            const [showHistoryModal, setShowHistoryModal] = useState(false);
            const [historyPage, setHistoryPage] = useState(0);
            const [selectedDate, setSelectedDate] = useState('');
            const [firebaseConnected, setFirebaseConnected] = useState(false);

            // Load data from Firebase or localStorage
            useEffect(() => {
                const loadData = async () => {
                    if (db) {
                        try {
                            const snapshot = await db.ref('weekHistory').once('value');
                            const data = snapshot.val();
                            if (data) {
                                setWeekHistory(data);
                                setFirebaseConnected(true);
                            }
                        } catch (error) {
                            console.error("Firebase load error:", error);
                            loadFromLocalStorage();
                        }
                    } else {
                        loadFromLocalStorage();
                    }
                };

                const loadFromLocalStorage = () => {
                    try {
                        const saved = localStorage.getItem('carpoolHistory');
                        if (saved) {
                            setWeekHistory(JSON.parse(saved));
                        }
                    } catch (error) {
                        console.error("LocalStorage load error:", error);
                    }
                };

                loadData();
            }, []);

            // Save to Firebase and localStorage
            const saveData = async (newHistory) => {
                if (db && firebaseConnected) {
                    try {
                        await db.ref('weekHistory').set(newHistory);
                    } catch (error) {
                        console.error("Firebase save error:", error);
                    }
                }
                
                try {
                    localStorage.setItem('carpoolHistory', JSON.stringify(newHistory));
                } catch (error) {
                    console.error("LocalStorage save error:", error);
                }
            };

            const getCurrentWeekData = () => {
                const weekKey = getWeekKey(selectedWeekStart);
                return weekHistory[weekKey] || { selections: {}, assignments: {}, lastGenerated: null };
            };

            const weekData = getCurrentWeekData();
            const selections = weekData.selections;
            const assignments = weekData.assignments;
            const lastGenerated = weekData.lastGenerated;

            const isCurrentWeek = getWeekKey(selectedWeekStart) === getWeekKey(currentWeekStart);
            const isReadOnly = !isCurrentWeek;

            const isDateInPast = (practiceId) => {
                if (!isCurrentWeek) return true;
                
                const dayMap = { 'pon': 1, 'uto': 2, 'cet': 4, 'pet': 5, 'sub': 6 };
                const now = new Date();
                const today = now.getDay();
                const hour = now.getHours();
                
                if (today === 6 && hour >= 15) return false;
                if (today === 0) return false;
                if (today === 6 && practiceId === 'sub') return false;
                
                return dayMap[practiceId] < today || (dayMap[practiceId] === today && practiceId !== 'sub');
            };

            const updateWeekData = (newSelections, newAssignments, newLastGenerated) => {
                const weekKey = getWeekKey(selectedWeekStart);
                const newHistory = {
                    ...weekHistory,
                    [weekKey]: {
                        selections: newSelections || selections,
                        assignments: newAssignments || assignments,
                        lastGenerated: newLastGenerated !== undefined ? newLastGenerated : lastGenerated
                    }
                };
                setWeekHistory(newHistory);
                saveData(newHistory);
            };

            const toggleSelection = (item, day, type) => {
                if (isReadOnly) return;
                const key = `${item}-${day}-${type}`;
                const newSelections = { ...selections, [key]: !selections[key] };
                updateWeekData(newSelections, assignments, lastGenerated);
            };

            const isSelected = (item, day, type) => {
                return selections[`${item}-${day}-${type}`] || false;
            };

            const getAttendingChildren = (day) => {
                return children.filter(child => isSelected(child, day, 'child'));
            };

            const getAvailableDrivers = (day, direction) => {
                return families.filter(family => isSelected(family, day, direction));
            };

            const getFamilyColor = (family) => {
                if (family === 'Vlahoviƒá') return 'bg-blue-100 text-blue-800';
                if (family === '≈†ipek') return 'bg-purple-100 text-purple-800';
                return 'bg-orange-100 text-orange-800';
            };

            const generateAssignments = () => {
                if (isReadOnly) return;
                
                const newAssignments = { ...assignments };
                const counts = {};
                
                families.forEach(f => {
                    counts[f] = Object.values(assignments).filter(d => d === f).length;
                });

                practices.forEach(practice => {
                    if (isDateInPast(practice.id)) return;
                    
                    const attending = getAttendingChildren(practice.id);
                    if (attending.length === 0) return;

                    const availTo = getAvailableDrivers(practice.id, 'tamo');
                    const availFrom = getAvailableDrivers(practice.id, 'nazad');

                    if (availTo.length > 0) {
                        const driver = availTo.reduce((min, f) => counts[f] < counts[min] ? f : min);
                        newAssignments[`${practice.id}-tamo`] = driver;
                        counts[driver]++;
                    }

                    if (availFrom.length > 0) {
                        const options = availFrom.filter(f => f !== newAssignments[`${practice.id}-tamo`]);
                        const final = options.length > 0 ? options : availFrom;
                        const driver = final.reduce((min, f) => counts[f] < counts[min] ? f : min);
                        newAssignments[`${practice.id}-nazad`] = driver;
                        counts[driver]++;
                    }
                });

                const now = new Date();
                updateWeekData(selections, newAssignments, now);
                setShowResults(true);
            };

            const resetCurrentWeek = () => {
                if (isReadOnly) return;
                const weekKey = getWeekKey(selectedWeekStart);
                const newHistory = { ...weekHistory };
                delete newHistory[weekKey];
                setWeekHistory(newHistory);
                saveData(newHistory);
                setShowResults(false);
            };

            const getAllWeeks = () => {
                const weeks = new Set();
                weeks.add(getWeekKey(currentWeekStart));
                Object.keys(weekHistory).forEach(key => weeks.add(key));
                
                return Array.from(weeks)
                    .map(key => new Date(key))
                    .sort((a, b) => b - a);
            };

            const handleWeekChange = (weekStart) => {
                setSelectedWeekStart(weekStart);
                setShowResults(false);
            };

            const handleDateSelect = () => {
                if (!selectedDate) return;
                const date = new Date(selectedDate);
                const monday = getMondayOfWeek(date);
                handleWeekChange(monday);
            };

            // History Modal
            const ITEMS_PER_PAGE = 10;
            const allWeeks = getAllWeeks();
            const totalPages = Math.ceil(allWeeks.length / ITEMS_PER_PAGE);
            const paginatedWeeks = allWeeks.slice(
                historyPage * ITEMS_PER_PAGE,
                (historyPage + 1) * ITEMS_PER_PAGE
            );

            if (showHistoryModal) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                            <div className="sticky top-0 bg-white border-b p-6">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">üìö Povijest Rasporeda</h2>
                                    <button 
                                        onClick={() => {
                                            setShowHistoryModal(false);
                                            setHistoryPage(0);
                                        }}
                                        className="text-gray-500 hover:text-gray-700 text-2xl"
                                    >
                                        √ó
                                    </button>
                                </div>
                            </div>

                            <div className="p-6">
                                <div className="space-y-2">
                                    {paginatedWeeks.map((weekStart) => {
                                        const weekKey = getWeekKey(weekStart);
                                        const isCurrent = weekKey === getWeekKey(currentWeekStart);
                                        const weekData = weekHistory[weekKey] || {};
                                        const hasData = Object.keys(weekData.selections || {}).length > 0;
                                        
                                        return (
                                            <button
                                                key={weekKey}
                                                onClick={() => {
                                                    handleWeekChange(weekStart);
                                                    setShowHistoryModal(false);
                                                    setHistoryPage(0);
                                                }}
                                                className={`w-full text-left p-4 rounded border-2 transition-all ${
                                                    getWeekKey(selectedWeekStart) === weekKey
                                                        ? 'border-blue-500 bg-blue-50'
                                                        : 'border-gray-200 hover:border-blue-300 hover:bg-gray-50'
                                                }`}
                                            >
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <div className="font-semibold">
                                                            {formatWeekRange(weekStart)}
                                                            {isCurrent && <span className="ml-2 text-green-600">(Trenutni)</span>}
                                                        </div>
                                                        {weekData.lastGenerated && (
                                                            <div className="text-sm text-gray-600">
                                                                Generirano: {new Date(weekData.lastGenerated).toLocaleDateString('hr-HR')}
                                                            </div>
                                                        )}
                                                    </div>
                                                    {hasData ? (
                                                        <span className="text-green-600">‚úì</span>
                                                    ) : (
                                                        <span className="text-gray-300">‚óã</span>
                                                    )}
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>

                                {totalPages > 1 && (
                                    <div className="flex justify-between items-center mt-6 pt-4 border-t">
                                        <button
                                            onClick={() => setHistoryPage(Math.max(0, historyPage - 1))}
                                            disabled={historyPage === 0}
                                            className={`px-4 py-2 rounded ${
                                                historyPage === 0
                                                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                            }`}
                                        >
                                            ‚Üê Prethodni
                                        </button>
                                        <span className="text-sm text-gray-600">
                                            Stranica {historyPage + 1} od {totalPages}
                                        </span>
                                        <button
                                            onClick={() => setHistoryPage(Math.min(totalPages - 1, historyPage + 1))}
                                            disabled={historyPage === totalPages - 1}
                                            className={`px-4 py-2 rounded ${
                                                historyPage === totalPages - 1
                                                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                            }`}
                                        >
                                            Sljedeƒái ‚Üí
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (showResults) {
                return (
                    <div className="max-w-6xl mx-auto p-4 sm:p-6">
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <div className="flex flex-col gap-4">
                                <div className="flex justify-between items-start">
                                    <h1 className="text-2xl font-bold">üìã Predlo≈æeni Raspored Prijevoza</h1>
                                    {!firebaseConnected && (
                                        <div className="text-xs text-orange-600 bg-orange-50 px-3 py-1 rounded">
                                            ‚ö†Ô∏è Lokalni re≈æim
                                        </div>
                                    )}
                                </div>
                                
                                <div className="flex flex-col sm:flex-row gap-3">
                                    <div className="flex items-center gap-2">
                                        <label className="text-sm font-medium text-gray-700">üìÖ Odaberi datum:</label>
                                        <input
                                            type="date"
                                            value={selectedDate}
                                            onChange={(e) => setSelectedDate(e.target.value)}
                                            className="border border-gray-300 rounded px-3 py-1 text-sm"
                                        />
                                        <button
                                            onClick={handleDateSelect}
                                            className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600"
                                        >
                                            Idi
                                        </button>
                                    </div>
                                    <button
                                        onClick={() => setShowHistoryModal(true)}
                                        className="bg-purple-500 text-white px-4 py-1 rounded text-sm hover:bg-purple-600"
                                    >
                                        üìö Povijest
                                    </button>
                                </div>

                                <div className="flex items-center justify-between">
                                    <div className="text-lg font-semibold text-blue-600">
                                        Tjedan: {formatWeekRange(selectedWeekStart)}
                                        {isCurrentWeek && <span className="text-green-600 ml-2">(Trenutni)</span>}
                                    </div>
                                    {isReadOnly && (
                                        <div className="bg-gray-100 border border-gray-300 rounded px-4 py-2 text-sm">
                                            <span className="text-gray-700">üîí Samo ƒçitanje</span>
                                        </div>
                                    )}
                                </div>

                                {lastGenerated && (
                                    <p className="text-sm text-green-600">
                                        Generirano: {new Date(lastGenerated).toLocaleString('hr-HR')}
                                    </p>
                                )}
                            </div>
                        </div>

                        {/* Djeca koja dolaze */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">üë¶ Djeca koja dolaze</h2>
                            <div className="overflow-x-auto px-4 sm:px-0">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-blue-50">
                                            <th className="border p-2 text-center">Dijete</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2 text-center">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {children.map(child => (
                                            <tr key={child}>
                                                <td className="border p-2 font-bold text-center">{child}</td>
                                                {practices.map(p => (
                                                    <td key={p.id} className="border p-2 text-center">
                                                        {getAttendingChildren(p.id).includes(child) ? 
                                                            <span className="text-green-600 font-bold text-xl">‚úì</span> : 
                                                            <span className="text-gray-300">‚Äî</span>
                                                        }
                                                    </td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Prijedlog vozaƒça */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">üöó Prijedlog vozaƒça</h2>
                            <div className="overflow-x-auto px-4 sm:px-0">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-green-50">
                                            <th className="border p-2">Smjer</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2 text-center">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="border p-2 font-bold">Tamo</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2 text-center">
                                                    {assignments[`${p.id}-tamo`] ? (
                                                        <span className={`px-2 py-1 rounded text-sm ${getFamilyColor(assignments[`${p.id}-tamo`])}`}>
                                                            {assignments[`${p.id}-tamo`]}
                                                        </span>
                                                    ) : <span className="text-gray-400">‚Äî</span>}
                                                </td>
                                            ))}
                                        </tr>
                                        <tr>
                                            <td className="border p-2 font-bold">Nazad</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2 text-center">
                                                    {assignments[`${p.id}-nazad`] ? (
                                                        <span className={`px-2 py-1 rounded text-sm ${getFamilyColor(assignments[`${p.id}-nazad`])}`}>
                                                            {assignments[`${p.id}-nazad`]}
                                                        </span>
                                                    ) : <span className="text-gray-400">‚Äî</span>}
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Dostupni vozaƒçi */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">üë• Dostupni vozaƒçi</h2>
                            <div className="overflow-x-auto px-4 sm:px-0">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-gray-50">
                                            <th className="border p-2">Smjer</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2 text-center">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="border p-2 font-bold">Tamo</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {getAvailableDrivers(p.id, 'tamo').map(f => (
                                                            <span key={f} className={`px-2 py-1 rounded text-xs ${getFamilyColor(f)}`}>
                                                                {f}
                                                            </span>
                                                        ))}
                                                        {getAvailableDrivers(p.id, 'tamo').length === 0 && (
                                                            <span className="text-gray-400 text-xs">Nitko</span>
                                                        )}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                        <tr>
                                            <td className="border p-2 font-bold">Nazad</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {getAvailableDrivers(p.id, 'nazad').map(f => (
                                                            <span key={f} className={`px-2 py-1 rounded text-xs ${getFamilyColor(f)}`}>
                                                                {f}
                                                            </span>
                                                        ))}
                                                        {getAvailableDrivers(p.id, 'nazad').length === 0 && (
                                                            <span className="text-gray-400 text-xs">Nitko</span>
                                                        )}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="flex gap-4 justify-center flex-wrap">
                            <button onClick={() => setShowResults(false)} className="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">
                                Nazad
                            </button>
                            {!isReadOnly && (
                                <button onClick={resetCurrentWeek} className="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600">
                                    üóëÔ∏è Reset Ovaj Tjedan
                                </button>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto p-4 sm:p-6">
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <div className="flex flex-col gap-4">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h1 className="text-2xl font-bold mb-2">üèÄ Tjedni Raspored Treninga</h1>
                                    <p className="text-gray-600">Oznaƒçite kada dijete dolazi i kada mo≈æete voziti</p>
                                </div>
                                {!firebaseConnected && (
                                    <div className="text-xs text-orange-600 bg-orange-50 px-3 py-2 rounded">
                                        ‚ö†Ô∏è Lokalni re≈æim - podaci nisu podijeljeni
                                    </div>
                                )}
                            </div>
                            
                            <div className="flex flex-col sm:flex-row gap-3">
                                <div className="flex items-center gap-2">
                                    <label className="text-sm font-medium text-gray-700">üìÖ Odaberi datum:</label>
                                    <input
                                        type="date"
                                        value={selectedDate}
                                        onChange={(e) => setSelectedDate(e.target.value)}
                                        className="border border-gray-300 rounded px-3 py-2"
                                    />
                                    <button
                                        onClick={handleDateSelect}
                                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                                    >
                                        Idi
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowHistoryModal(true)}
                                    className="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600"
                                >
                                    üìö Povijest Rasporeda
                                </button>
                            </div>

                            <div className="flex items-center justify-between">
                                <div className="text-lg font-semibold text-blue-600">
                                    Tjedan: {formatWeekRange(selectedWeekStart)}
                                    {isCurrentWeek && <span className="text-green-600 ml-2">(Trenutni)</span>}
                                </div>
                                {isReadOnly && (
                                    <div className="bg-gray-100 border border-gray-300 rounded px-4 py-2 text-sm">
                                        <span className="text-gray-700">üîí Samo ƒçitanje</span>
                                    </div>
                                )}
                            </div>

                            {lastGenerated && (
                                <p className="text-sm text-green-600">
                                    Zadnji raspored: {new Date(lastGenerated).toLocaleString('hr-HR')}
                                </p>
                            )}
                        </div>
                    </div>

                    {/* Tablica 1: Djeca */}
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-lg font-bold mb-4">üë¶ Koji dan ƒáe dijete iƒái na trening?</h2>
                        <div className="overflow-x-auto px-4 sm:px-0">
                            <table className="w-full border-collapse border">
                                <thead>
                                    <tr className="bg-blue-50">
                                        <th className="border p-2">Dijete</th>
                                        {practices.map(p => {
                                            const isPast = isDateInPast(p.id);
                                            return (
                                                <th key={p.id} className={`border p-2 text-center ${isPast ? 'bg-gray-200' : ''}`}>
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{isPast ? '(zavr≈°eno)' : p.time}</div>
                                                </th>
                                            );
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {children.map(child => (
                                        <tr key={child}>
                                            <td className="border p-2 font-bold">{child}</td>
                                            {practices.map(p => {
                                                const isPast = isDateInPast(p.id);
                                                const isDisabled = isPast || isReadOnly;
                                                return (
                                                    <td key={p.id} className="border p-2 text-center">
                                                        <input
                                                            type="checkbox"
                                                            checked={isSelected(child, p.id, 'child')}
                                                            onChange={(e) => {
                                                                e.stopPropagation();
                                                                if (!isDisabled) toggleSelection(child, p.id, 'child');
                                                            }}
                                                            disabled={isDisabled}
                                                            className={`w-5 h-5 ${isDisabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}`}
                                                        />
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Tablica 2: Vozaƒçi */}
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-lg font-bold mb-4">üöó Kada koja obitelj mo≈æe voziti?</h2>
                        <div className="overflow-x-auto px-4 sm:px-0">
                            <table className="w-full border-collapse border">
                                <thead>
                                    <tr className="bg-green-50">
                                        <th className="border p-2">Obitelj</th>
                                        {practices.map(p => {
                                            const isPast = isDateInPast(p.id);
                                            return (
                                                <th key={p.id} className={`border p-2 text-center ${isPast ? 'bg-gray-200' : ''}`}>
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{isPast ? '(zavr≈°eno)' : p.time}</div>
                                                </th>
                                            );
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {families.map(family => (
                                        <tr key={family}>
                                            <td className="border p-2 font-bold">{family}</td>
                                            {practices.map(p => {
                                                const isPast = isDateInPast(p.id);
                                                const isDisabled = isPast || isReadOnly;
                                                return (
                                                    <td key={p.id} className="border p-2">
                                                        <div className="flex gap-3 justify-center">
                                                            <label className={`flex flex-col items-center min-h-12 justify-center p-2 rounded ${isDisabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer hover:bg-green-50'}`}>
                                                                <span className="text-xs mb-1">tamo</span>
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected(family, p.id, 'tamo')}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        if (!isDisabled) toggleSelection(family, p.id, 'tamo');
                                                                    }}
                                                                    disabled={isDisabled}
                                                                    className={`w-5 h-5 ${isDisabled ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                                                                />
                                                            </label>
                                                            <label className={`flex flex-col items-center min-h-12 justify-center p-2 rounded ${isDisabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer hover:bg-orange-50'}`}>
                                                                <span className="text-xs mb-1">nazad</span>
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected(family, p.id, 'nazad')}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        if (!isDisabled) toggleSelection(family, p.id, 'nazad');
                                                                    }}
                                                                    disabled={isDisabled}
                                                                    className={`w-5 h-5 ${isDisabled ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                                                                />
                                                            </label>
                                                        </div>
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div className="text-center">
                        <button 
                            onClick={generateAssignments}
                            disabled={isReadOnly}
                            className={`px-8 py-3 rounded-lg font-bold text-lg ${
                                isReadOnly 
                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                    : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                        >
                            üîÑ Generiraj Raspored Prijevoza
                        </button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CarpoolApp />, document.getElementById('root'));
    </script>
</body>
</html>
