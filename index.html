<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <title>Ko≈°arka brum brum üöó</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const CarpoolApp = () => {
            const practices = [
                { id: 'pon', day: 'Pon', time: '20:00-21:15' },
                { id: 'uto', day: 'Uto', time: '18:30-20:00' },
                { id: 'cet', day: 'ƒået', time: '18:30-20:00' },
                { id: 'pet', day: 'Pet', time: '17:00-18:30' },
                { id: 'sub', day: 'Sub', time: '13:00-14:30' }
            ];

            const children = ['Bartol', 'Ivano', 'Mak'];
            const families = ['Vlahoviƒá', '≈†ipek', 'Mariƒá'];

            const [selections, setSelections] = useState({});
            const [assignments, setAssignments] = useState({});
            const [showResults, setShowResults] = useState(false);
            const [lastGenerated, setLastGenerated] = useState(null);

            const isDateInPast = (practiceId) => {
                const dayMap = { 'pon': 1, 'uto': 2, 'cet': 4, 'pet': 5, 'sub': 6 };
                const today = new Date().getDay();
                if (today === 0) return false;
                return dayMap[practiceId] <= today;
            };

            const toggleSelection = (item, day, type) => {
                const key = `${item}-${day}-${type}`;
                setSelections(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const isSelected = (item, day, type) => {
                return selections[`${item}-${day}-${type}`] || false;
            };

            const getAttendingChildren = (day) => {
                return children.filter(child => isSelected(child, day, 'child'));
            };

            const getAvailableDrivers = (day, direction) => {
                return families.filter(family => isSelected(family, day, direction));
            };

            const getFamilyColor = (family) => {
                if (family === 'Vlahoviƒá') return 'bg-blue-100 text-blue-800';
                if (family === '≈†ipek') return 'bg-purple-100 text-purple-800';
                return 'bg-orange-100 text-orange-800';
            };

            const generateAssignments = () => {
                const newAssignments = { ...assignments };
                const counts = {};
                
                families.forEach(f => {
                    counts[f] = Object.values(assignments).filter(d => d === f).length;
                });

                practices.forEach(practice => {
                    if (isDateInPast(practice.id)) return;
                    
                    const attending = getAttendingChildren(practice.id);
                    if (attending.length === 0) return;

                    const availTo = getAvailableDrivers(practice.id, 'tamo');
                    const availFrom = getAvailableDrivers(practice.id, 'nazad');

                    if (availTo.length > 0) {
                        const driver = availTo.reduce((min, f) => counts[f] < counts[min] ? f : min);
                        newAssignments[`${practice.id}-tamo`] = driver;
                        counts[driver]++;
                    }

                    if (availFrom.length > 0) {
                        const options = availFrom.filter(f => f !== newAssignments[`${practice.id}-tamo`]);
                        const final = options.length > 0 ? options : availFrom;
                        const driver = final.reduce((min, f) => counts[f] < counts[min] ? f : min);
                        newAssignments[`${practice.id}-nazad`] = driver;
                        counts[driver]++;
                    }
                });

                setAssignments(newAssignments);
                setLastGenerated(new Date());
                setShowResults(true);
            };

            const reset = () => {
                setSelections({});
                setAssignments({});
                setShowResults(false);
                setLastGenerated(null);
            };

            if (showResults) {
                return (
                    <div className="max-w-6xl mx-auto p-4 sm:p-6">
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h1 className="text-2xl font-bold mb-4">üìã Predlo≈æeni Raspored Prijevoza</h1>
                            {lastGenerated && (
                                <p className="text-sm text-green-600">
                                    üìÖ Generirano: {lastGenerated.toLocaleString('hr-HR')}
                                </p>
                            )}
                        </div>

                        {/* Djeca koja dolaze */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">üë¶ Djeca koja dolaze</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-blue-50">
                                            <th className="border p-2">Dijete</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {children.map(child => (
                                            <tr key={child}>
                                                <td className="border p-2 font-bold">{child}</td>
                                                {practices.map(p => (
                                                    <td key={p.id} className="border p-2 text-center">
                                                        {getAttendingChildren(p.id).includes(child) ? '‚úì' : '‚Äî'}
                                                    </td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Prijedlog vozaƒça */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">üöó Prijedlog vozaƒça</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-green-50">
                                            <th className="border p-2">Smjer</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="border p-2 font-bold">Tamo</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2 text-center">
                                                    {assignments[`${p.id}-tamo`] ? (
                                                        <span className={`px-2 py-1 rounded text-sm ${getFamilyColor(assignments[`${p.id}-tamo`])}`}>
                                                            {assignments[`${p.id}-tamo`]}
                                                        </span>
                                                    ) : '‚Äî'}
                                                </td>
                                            ))}
                                        </tr>
                                        <tr>
                                            <td className="border p-2 font-bold">Nazad</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2 text-center">
                                                    {assignments[`${p.id}-nazad`] ? (
                                                        <span className={`px-2 py-1 rounded text-sm ${getFamilyColor(assignments[`${p.id}-nazad`])}`}>
                                                            {assignments[`${p.id}-nazad`]}
                                                        </span>
                                                    ) : '‚Äî'}
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Dostupni vozaƒçi */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">üë• Dostupni vozaƒçi</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-gray-50">
                                            <th className="border p-2">Smjer</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="border p-2 font-bold">Tamo</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {getAvailableDrivers(p.id, 'tamo').map(f => (
                                                            <span key={f} className={`px-2 py-1 rounded text-xs ${getFamilyColor(f)}`}>
                                                                {f}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                        <tr>
                                            <td className="border p-2 font-bold">Nazad</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {getAvailableDrivers(p.id, 'nazad').map(f => (
                                                            <span key={f} className={`px-2 py-1 rounded text-xs ${getFamilyColor(f)}`}>
                                                                {f}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="flex gap-4 justify-center">
                            <button onClick={() => setShowResults(false)} className="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">
                                Nazad
                            </button>
                            <button onClick={reset} className="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600">
                                üóëÔ∏è Reset
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto p-4 sm:p-6">
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h1 className="text-2xl font-bold mb-2">üèÄ Tjedni Raspored Treninga</h1>
                        <p className="text-gray-600">Oznaƒçite kada dijete dolazi i kada mo≈æete voziti</p>
                        {lastGenerated && (
                            <p className="text-sm text-green-600 mt-2">
                                üìÖ Zadnji raspored: {lastGenerated.toLocaleString('hr-HR')}
                            </p>
                        )}
                    </div>

                    {/* Tablica 1: Djeca */}
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-lg font-bold mb-4">üë¶ Koji dan ƒáe dijete iƒái na trening?</h2>
                        <div className="overflow-x-auto">
                            <table className="w-full border-collapse border">
                                <thead>
                                    <tr className="bg-blue-50">
                                        <th className="border p-2">Dijete</th>
                                        {practices.map(p => {
                                            const isPast = isDateInPast(p.id);
                                            return (
                                                <th key={p.id} className={`border p-2 ${isPast ? 'bg-gray-200' : ''}`}>
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{isPast ? '(zavr≈°eno)' : p.time}</div>
                                                </th>
                                            );
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {children.map(child => (
                                        <tr key={child}>
                                            <td className="border p-2 font-bold">{child}</td>
                                            {practices.map(p => {
                                                const isPast = isDateInPast(p.id);
                                                return (
                                                    <td key={p.id} className="border p-2 text-center">
                                                        <input
                                                            type="checkbox"
                                                            checked={isSelected(child, p.id, 'child')}
                                                            onChange={(e) => {
                                                                e.stopPropagation();
                                                                if (!isPast) toggleSelection(child, p.id, 'child');
                                                            }}
                                                            disabled={isPast}
                                                            className="w-5 h-5 cursor-pointer"
                                                            style={{ cursor: isPast ? 'not-allowed' : 'pointer' }}
                                                        />
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Tablica 2: Vozaƒçi */}
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-lg font-bold mb-4">üöó Kada koja obitelj mo≈æe voziti?</h2>
                        <div className="overflow-x-auto">
                            <table className="w-full border-collapse border">
                                <thead>
                                    <tr className="bg-green-50">
                                        <th className="border p-2">Obitelj</th>
                                        {practices.map(p => {
                                            const isPast = isDateInPast(p.id);
                                            return (
                                                <th key={p.id} className={`border p-2 ${isPast ? 'bg-gray-200' : ''}`}>
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{isPast ? '(zavr≈°eno)' : p.time}</div>
                                                </th>
                                            );
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {families.map(family => (
                                        <tr key={family}>
                                            <td className="border p-2 font-bold">{family}</td>
                                            {practices.map(p => {
                                                const isPast = isDateInPast(p.id);
                                                return (
                                                    <td key={p.id} className="border p-2">
                                                        <div className="flex gap-2 justify-center">
                                                            <label className="flex flex-col items-center cursor-pointer">
                                                                <span className="text-xs mb-1">tamo</span>
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected(family, p.id, 'tamo')}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        if (!isPast) toggleSelection(family, p.id, 'tamo');
                                                                    }}
                                                                    disabled={isPast}
                                                                    className="w-5 h-5 cursor-pointer"
                                                                    style={{ cursor: isPast ? 'not-allowed' : 'pointer' }}
                                                                />
                                                            </label>
                                                            <label className="flex flex-col items-center cursor-pointer">
                                                                <span className="text-xs mb-1">nazad</span>
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected(family, p.id, 'nazad')}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        if (!isPast) toggleSelection(family, p.id, 'nazad');
                                                                    }}
                                                                    disabled={isPast}
                                                                    className="w-5 h-5 cursor-pointer"
                                                                    style={{ cursor: isPast ? 'not-allowed' : 'pointer' }}
                                                                />
                                                            </label>
                                                        </div>
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div className="text-center">
                        <button 
                            onClick={generateAssignments}
                            className="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 text-lg"
                        >
                            üîÑ Generiraj Raspored Prijevoza
                        </button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CarpoolApp />, document.getElementById('root'));
    </script>
</body>
</html>
