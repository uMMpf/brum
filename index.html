<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Košarka brum brum 🚗</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide Icons as inline SVG components
        const Calendar = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
        );

        const Shuffle = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22"/><path d="m18 2 4 4-4 4"/><path d="M2 6h1.9c1.5 0 2.9.9 3.6 2.2"/><path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8"/><path d="m18 14 4 4-4 4"/></svg>
        );

        const CheckCircle2 = ({ className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
        );

        const Car = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></svg>
        );

        const Users = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        );

        function CarpoolCoordinator() {
            const practices = [
                { id: 'pon', day: 'Pon', fullDay: 'Ponedjeljak', time: '20:00-21:15', location: 'Trčanje u Utrinama' },
                { id: 'uto', day: 'Uto', fullDay: 'Utorak', time: '18:30-20:00', location: 'Zapruđe' },
                { id: 'cet', day: 'Čet', fullDay: 'Četvrtak', time: '18:30-20:00', location: 'Zapruđe' },
                { id: 'pet', day: 'Pet', fullDay: 'Petak', time: '17:00-18:30', location: 'Zapruđe' },
                { id: 'sub', day: 'Sub', fullDay: 'Subota', time: '13:00-14:30', location: 'Zapruđe' }
            ];

            const children = ['Bartol', 'Ivano', 'Mak'];
            const families = ['Vlahović', 'Šipek', 'Marić'];

            const [selections, setSelections] = useState({});
            const [assignments, setAssignments] = useState({});
            const [showAssignments, setShowAssignments] = useState(false);
            const [lastGenerated, setLastGenerated] = useState(null);
            const [currentWeek, setCurrentWeek] = useState(() => {
                const now = new Date();
                const startOfYear = new Date(now.getFullYear(), 0, 1);
                const pastDaysOfYear = (now - startOfYear) / 86400000;
                return Math.ceil((pastDaysOfYear + startOfYear.getDay() + 1) / 7);
            });

            const getCurrentWeekDates = () => {
                const now = new Date();
                const dayOfWeek = now.getDay();
                const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                const monday = new Date(now);
                monday.setDate(now.getDate() + mondayOffset);
                
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                
                return {
                    start: monday.toLocaleDateString('hr-HR', { day: 'numeric', month: 'numeric' }),
                    end: sunday.toLocaleDateString('hr-HR', { day: 'numeric', month: 'numeric' })
                };
            };

            const isDateInPast = (practiceId) => {
                const today = new Date();
                const currentDay = today.getDay();
                
                const dayMap = { 'pon': 1, 'uto': 2, 'cet': 4, 'pet': 5, 'sub': 6 };
                const practiceDay = dayMap[practiceId];
                
                if (currentDay === 0) {
                    return false;
                } else {
                    return practiceDay <= currentDay;
                }
            };

            const resetForNewWeek = () => {
                setSelections({});
                setAssignments({});
                setShowAssignments(false);
                setLastGenerated(null);
                const now = new Date();
                const startOfYear = new Date(now.getFullYear(), 0, 1);
                const pastDaysOfYear = (now - startOfYear) / 86400000;
                setCurrentWeek(Math.ceil((pastDaysOfYear + startOfYear.getDay() + 1) / 7));
            };

            const toggleSelection = (item, day, type) => {
                const key = `${item}-${day}-${type}`;
                setSelections(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const isSelected = (item, day, type) => {
                return selections[`${item}-${day}-${type}`] || false;
            };

            const getAttendingChildren = (day) => {
                return children.filter(child => isSelected(child, day, 'child'));
            };

            const getAvailableDrivers = (day, direction) => {
                return families.filter(family => isSelected(family, day, direction));
            };

            const getFamilyColorClass = (family) => {
                if (family === 'Vlahović') return 'bg-blue-100 text-blue-800';
                if (family === 'Šipek') return 'bg-purple-100 text-purple-800';
                return 'bg-orange-100 text-orange-800';
            };

            const generateAssignments = () => {
                const newAssignments = { ...assignments };
                const drivingCounts = {};
                
                families.forEach(family => {
                    drivingCounts[family] = Object.values(assignments).filter(driver => driver === family).length;
                });

                practices.forEach(practice => {
                    if (isDateInPast(practice.id)) return;

                    const attendingChildren = getAttendingChildren(practice.id);
                    if (attendingChildren.length === 0) return;

                    const availableToDrivers = getAvailableDrivers(practice.id, 'tamo');
                    const availableFromDrivers = getAvailableDrivers(practice.id, 'nazad');

                    if (availableToDrivers.length > 0) {
                        const toDriver = availableToDrivers.reduce((min, family) => 
                            drivingCounts[family] < drivingCounts[min] ? family : min
                        );
                        newAssignments[`${practice.id}-tamo`] = toDriver;
                        drivingCounts[toDriver]++;
                    }

                    if (availableFromDrivers.length > 0) {
                        const fromOptions = availableFromDrivers.filter(family => 
                            family !== newAssignments[`${practice.id}-tamo`]
                        );
                        const finalFromOptions = fromOptions.length > 0 ? fromOptions : availableFromDrivers;
                        
                        const fromDriver = finalFromOptions.reduce((min, family) => 
                            drivingCounts[family] < drivingCounts[min] ? family : min
                        );
                        newAssignments[`${practice.id}-nazad`] = fromDriver;
                        drivingCounts[fromDriver]++;
                    }
                });

                setAssignments(newAssignments);
                setLastGenerated(new Date());
                setShowAssignments(true);
            };

            if (showAssignments) {
                return (
                    <div className="max-w-6xl mx-auto p-4 sm:p-6 bg-white min-h-screen">
                        <div className="mb-6 sm:mb-8">
                            <h1 className="text-xl sm:text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2">
                                <CheckCircle2 className="text-green-600" />
                                Predloženi Raspored Prijevoza
                            </h1>
                            <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
                                <div className="flex flex-col gap-1">
                                    <p className="text-gray-600 text-sm sm:text-base">
                                        Tjedan {currentWeek} ({getCurrentWeekDates().start} - {getCurrentWeekDates().end})
                                    </p>
                                    {lastGenerated && (
                                        <p className="text-xs text-green-600 font-medium">
                                            📅 Zadnje generirano: {lastGenerated.toLocaleDateString('hr-HR')} u {lastGenerated.toLocaleTimeString('hr-HR', { hour: '2-digit', minute: '2-digit' })}
                                        </p>
                                    )}
                                </div>
                                <button
                                    onClick={resetForNewWeek}
                                    className="bg-red-500 text-white px-3 py-2 sm:px-4 rounded-lg hover:bg-red-600 transition-colors text-sm self-start sm:self-auto"
                                >
                                    🗑️ Reset za novi tjedan
                                </button>
                            </div>
                        </div>

                        <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                            <button onClick={() => setShowAssignments(false)} className="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                                Nazad
                            </button>
                            <button onClick={resetForNewWeek} className="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm sm:text-base">
                                🗑️ Reset
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto p-4 sm:p-6 bg-white min-h-screen">
                    <div className="mb-6">
                        <div className="flex flex-col sm:flex-row sm:items-center justify-between mb-2 gap-2">
                            <h1 className="text-xl sm:text-2xl font-bold text-gray-900 flex items-center gap-2">
                                <Calendar />
                                Tjedni Raspored Treninga
                            </h1>
                            <button onClick={resetForNewWeek} className="bg-red-500 text-white px-3 py-2 sm:px-4 rounded-lg hover:bg-red-600 transition-colors text-sm self-start sm:self-auto">
                                🗑️ Reset za novi tjedan
                            </button>
                        </div>
                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
                            <div className="flex flex-col gap-1">
                                <p className="text-gray-600 text-sm sm:text-base">Označite kada dijete dolazi i kada možete voziti</p>
                                {lastGenerated && (
                                    <p className="text-xs text-green-600 font-medium">
                                        📅 Zadnji raspored: {lastGenerated.toLocaleDateString('hr-HR')} u {lastGenerated.toLocaleTimeString('hr-HR', { hour: '2-digit', minute: '2-digit' })}
                                    </p>
                                )}
                            </div>
                            <p className="text-xs sm:text-sm text-gray-500">
                                Tjedan {currentWeek} ({getCurrentWeekDates().start} - {getCurrentWeekDates().end})
                            </p>
                        </div>
                    </div>

                    <div className="mt-6 text-center">
                        <button onClick={generateAssignments} className="bg-blue-600 text-white px-6 py-3 sm:px-8 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2 mx-auto text-sm sm:text-base">
                            <Shuffle size={18} className="sm:hidden" />
                            <Shuffle size={20} className="hidden sm:block" />
                            Generiraj Raspored Prijevoza
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<CarpoolCoordinator />, document.getElementById('root'));
    </script>
</body>
</html>
