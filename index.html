<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="bingbot" content="noindex, nofollow">
    <meta name="slurp" content="noindex, nofollow">
    <meta name="duckduckbot" content="noindex, nofollow">
    <meta name="baiduspider" content="noindex, nofollow">
    <meta name="yandex" content="noindex, nofollow">
    <meta name="anthropic-ai" content="noindex">
    <meta name="claudebot" content="noindex">
    <meta name="gptbot" content="noindex">
    <meta name="chatgpt-user" content="noindex">
    <meta name="ccbot" content="noindex">
    <meta name="applebot" content="noindex">
    <title>Košarka brum brum 🚗</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23FF6B35' stroke='%23000' stroke-width='2'/><path d='M 50 2 Q 50 50 50 98' stroke='%23000' stroke-width='2' fill='none'/><path d='M 2 50 Q 50 50 98 50' stroke='%23000' stroke-width='2' fill='none'/><path d='M 15 15 Q 50 50 85 85' stroke='%23000' stroke-width='2' fill='none'/><path d='M 85 15 Q 50 50 15 85' stroke='%23000' stroke-width='2' fill='none'/></svg>">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // PASTE YOUR GOOGLE APPS SCRIPT URL HERE
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz8LHqmrDFy1Up-MKwFE2uc4EamQbf8BTNXtlzTMmBmMCrzqzON5-BKN5TkuwYslsnV/exec';

        // NAME MAPPING - Real names only visible here, not in Google Sheets
        const NAME_MAP = {
            children: {
                'c1': 'Bartol',
                'c2': 'Ivano',
                'c3': 'Mak'
            },
            families: {
                'f1': 'Vlahović',
                'f2': 'Šipek',
                'f3': 'Marić'
            }
        };

        const CarpoolApp = () => {
            const practices = [
                { id: 'pon', day: 'Pon', time: '20:00-21:15' },
                { id: 'uto', day: 'Uto', time: '18:30-20:00' },
                { id: 'cet', day: 'Čet', time: '18:30-20:00' },
                { id: 'pet', day: 'Pet', time: '17:00-18:30' },
                { id: 'sub', day: 'Sub', time: '13:00-14:30' }
            ];

            const childrenIds = Object.keys(NAME_MAP.children);
            const familyIds = Object.keys(NAME_MAP.families);

            const getMondayOfWeek = (date) => {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day + (day === 0 ? -6 : 1);
                return new Date(d.setDate(diff));
            };

            const getCurrentWeekStart = () => {
                const now = new Date();
                const day = now.getDay();
                const hour = now.getHours();
                
                // Subota poslije 15:00 ili nedjelja = planiraj sljedeći tjedan
                if ((day === 6 && hour >= 15) || day === 0) {
                    const nextWeek = new Date(now);
                    // Koliko dana do sljedećeg ponedjeljka
                    const daysToAdd = day === 0 ? 1 : 2; // Nedjelja=1 dan, Subota=2 dana
                    nextWeek.setDate(now.getDate() + daysToAdd);
                    return getMondayOfWeek(nextWeek);
                }
                
                return getMondayOfWeek(now);
            };

            const formatWeekRange = (mondayDate) => {
                const monday = new Date(mondayDate);
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                
                const formatDate = (d) => {
                    return d.toLocaleDateString('hr-HR', { day: 'numeric', month: 'short', year: 'numeric' });
                };
                
                return `${formatDate(monday)} - ${formatDate(sunday)}`;
            };

            const getWeekKey = (mondayDate) => {
                return mondayDate.toISOString().split('T')[0];
            };

            const [currentWeekStart] = useState(getCurrentWeekStart());
            const [weekHistory, setWeekHistory] = useState({});
            const [showResults, setShowResults] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [isSaving, setIsSaving] = useState(false);
            const [connectionStatus, setConnectionStatus] = useState('checking');

            const loadFromSheets = async () => {
                if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                    console.log('Google Sheets not configured yet');
                    return false;
                }

                try {
                    const response = await fetch(SCRIPT_URL);
                    if (response.ok) {
                        const data = await response.json();
                        setWeekHistory(data);
                        setConnectionStatus('connected');
                        return true;
                    }
                } catch (error) {
                    console.error('Google Sheets load error:', error);
                }
                return false;
            };

            const saveToSheets = async (data) => {
                if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                    return false;
                }

                try {
                    setIsSaving(true);
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    setConnectionStatus('connected');
                    return true;
                } catch (error) {
                    console.error('Google Sheets save error:', error);
                    return false;
                } finally {
                    setIsSaving(false);
                }
            };

            useEffect(() => {
                const loadData = async () => {
                    setIsLoading(true);
                    const sheetsSuccess = await loadFromSheets();
                    
                    if (!sheetsSuccess) {
                        try {
                            const saved = localStorage.getItem('carpoolHistory');
                            if (saved) {
                                setWeekHistory(JSON.parse(saved));
                            }
                            setConnectionStatus('local');
                        } catch (error) {
                            console.error('LocalStorage load error:', error);
                            setConnectionStatus('local');
                        }
                    }
                    setIsLoading(false);
                };
                
                loadData();

                const interval = setInterval(() => {
                    if (connectionStatus === 'connected') {
                        loadFromSheets();
                    }
                }, 30000);

                return () => clearInterval(interval);
            }, []);

            const saveData = async (newHistory) => {
                setWeekHistory(newHistory);
                
                try {
                    localStorage.setItem('carpoolHistory', JSON.stringify(newHistory));
                } catch (error) {
                    console.error('LocalStorage save error:', error);
                }

                if (connectionStatus === 'connected') {
                    await saveToSheets(newHistory);
                }
            };

            const getCurrentWeekData = () => {
                const weekKey = getWeekKey(currentWeekStart);
                return weekHistory[weekKey] || { selections: {}, assignments: {}, lastGenerated: null };
            };

            const weekData = getCurrentWeekData();
            const selections = weekData.selections;
            const assignments = weekData.assignments;
            const lastGenerated = weekData.lastGenerated;

            const isDateInPast = (practiceId) => {
                const now = new Date();
                const today = now.getDay();
                const hour = now.getHours();
                const weekStart = currentWeekStart.getTime();
                const nowWeekStart = getMondayOfWeek(now).getTime();
                
                // Ako prikazujemo tjedan u budućnosti, ništa nije prošlo
                if (weekStart > nowWeekStart) return false;
                
                // Nedjelja ili subota poslije 15:00 = planiramo novi tjedan, sve je dostupno
                if ((today === 6 && hour >= 15) || today === 0) return false;
                
                const dayMap = { 'pon': 1, 'uto': 2, 'cet': 4, 'pet': 5, 'sub': 6 };
                
                // Subota prije 15:00 - subota još nije prošla
                if (today === 6 && practiceId === 'sub') return false;
                
                // Provjeri je li dan prošao
                return dayMap[practiceId] < today;
            };

            const updateWeekData = (newSelections, newAssignments, newLastGenerated) => {
                const weekKey = getWeekKey(currentWeekStart);
                const newHistory = {
                    ...weekHistory,
                    [weekKey]: {
                        selections: newSelections || selections,
                        assignments: newAssignments || assignments,
                        lastGenerated: newLastGenerated !== undefined ? newLastGenerated : lastGenerated
                    }
                };
                saveData(newHistory);
            };

            const toggleSelection = (item, day, type) => {
                const key = `${item}-${day}-${type}`;
                const newSelections = { ...selections, [key]: !selections[key] };
                updateWeekData(newSelections, assignments, lastGenerated);
            };

            const isSelected = (item, day, type) => {
                return selections[`${item}-${day}-${type}`] || false;
            };

            const getAttendingChildren = (day) => {
                return childrenIds.filter(childId => isSelected(childId, day, 'child'));
            };

            const getAvailableDrivers = (day, direction) => {
                return familyIds.filter(familyId => isSelected(familyId, day, direction));
            };

            const getFamilyColor = (familyId) => {
                if (familyId === 'f1') return 'bg-blue-100 text-blue-800';
                if (familyId === 'f2') return 'bg-purple-100 text-purple-800';
                return 'bg-orange-100 text-orange-800';
            };

            // Count how many families entered data
            const getFamiliesEnteredCount = () => {
                return familyIds.filter(familyId => {
                    return practices.some(practice => {
                        if (isDateInPast(practice.id)) return false;
                        return isSelected(familyId, practice.id, 'tamo') || 
                               isSelected(familyId, practice.id, 'nazad');
                    });
                }).length;
            };
                // Check if at least one child is attending
                const hasChildren = practices.some(practice => {
                    if (isDateInPast(practice.id)) return false;
                    return getAttendingChildren(practice.id).length > 0;
                });
                
                // Check if at least one family has entered availability
                const hasDrivers = familyIds.some(familyId => {
                    return practices.some(practice => {
                        if (isDateInPast(practice.id)) return false;
                        return isSelected(familyId, practice.id, 'tamo') || 
                               isSelected(familyId, practice.id, 'nazad');
                    });
                });
                
                return hasChildren && hasDrivers;
            };

            const generateAssignments = () => {
                const newAssignments = {};
                const counts = {};
                
                familyIds.forEach(f => {
                    counts[f] = 0;
                });

                practices.forEach(practice => {
                    if (isDateInPast(practice.id)) return;
                    
                    const attending = getAttendingChildren(practice.id);
                    if (attending.length === 0) return;

                    const availTo = getAvailableDrivers(practice.id, 'tamo');
                    const availFrom = getAvailableDrivers(practice.id, 'nazad');

                    if (availTo.length > 0) {
                        const driver = availTo.reduce((min, f) => counts[f] < counts[min] ? f : min);
                        newAssignments[`${practice.id}-tamo`] = driver;
                        counts[driver]++;
                    }

                    if (availFrom.length > 0) {
                        const options = availFrom.filter(f => f !== newAssignments[`${practice.id}-tamo`]);
                        const final = options.length > 0 ? options : availFrom;
                        const driver = final.reduce((min, f) => counts[f] < counts[min] ? f : min);
                        newAssignments[`${practice.id}-nazad`] = driver;
                        counts[driver]++;
                    }
                });

                const now = new Date();
                updateWeekData(selections, newAssignments, now);
                setShowResults(true);
            };

            const resetCurrentWeek = () => {
                const weekKey = getWeekKey(currentWeekStart);
                const newHistory = { ...weekHistory };
                delete newHistory[weekKey];
                saveData(newHistory);
                setShowResults(false);
            };

            if (isLoading) {
                return (
                    <div className="max-w-6xl mx-auto p-4 sm:p-6 flex items-center justify-center min-h-screen">
                        <div className="text-center">
                            <div className="text-4xl mb-4">🏀</div>
                            <div className="text-xl font-semibold">Učitavanje...</div>
                        </div>
                    </div>
                );
            }

            const StatusBadge = () => {
                if (isSaving) {
                    return (
                        <div className="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded flex items-center gap-2">
                            <div className="animate-spin">⟳</div>
                            Spremanje...
                        </div>
                    );
                }
                if (connectionStatus === 'connected') {
                    return (
                        <div className="text-xs bg-green-50 text-green-600 px-3 py-1 rounded">
                            ✓ Google Sheets povezan
                        </div>
                    );
                }
                return (
                    <div className="text-xs bg-orange-50 text-orange-600 px-3 py-1 rounded">
                        ⚠️ Lokalni režim - provjerite SCRIPT_URL
                    </div>
                );
            };

            if (showResults) {
                return (
                    <div className="max-w-6xl mx-auto p-4 sm:p-6">
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <div className="flex flex-col gap-4">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h1 className="text-2xl font-bold">📋 Predloženi Raspored Prijevoza</h1>
                                        <div className="flex items-center gap-2 mt-2">
                                            <div className="text-lg font-semibold text-blue-600">
                                                Tjedan: {formatWeekRange(currentWeekStart)}
                                            </div>
                                            {(() => {
                                                const now = new Date();
                                                const day = now.getDay();
                                                const hour = now.getHours();
                                                if ((day === 6 && hour >= 15) || day === 0) {
                                                    return <span className="text-sm bg-green-100 text-green-700 px-2 py-1 rounded">Novi tjedan</span>;
                                                }
                                                return <span className="text-sm bg-blue-100 text-blue-700 px-2 py-1 rounded">Trenutni tjedan</span>;
                                            })()}
                                        </div>
                                    </div>
                                    <StatusBadge />
                                </div>

                                {lastGenerated && (
                                    <p className="text-sm text-green-600">
                                        Generirano: {new Date(lastGenerated).toLocaleString('hr-HR')}
                                    </p>
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">👦 Djeca koja dolaze</h2>
                            <div className="overflow-x-auto px-4 sm:px-0">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-blue-50">
                                            <th className="border p-2 text-center">Dijete</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2 text-center">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {childrenIds.map(childId => (
                                            <tr key={childId}>
                                                <td className="border p-2 font-bold text-center">{NAME_MAP.children[childId]}</td>
                                                {practices.map(p => (
                                                    <td key={p.id} className="border p-2 text-center">
                                                        {getAttendingChildren(p.id).includes(childId) ? 
                                                            <span className="text-green-600 font-bold text-xl">✓</span> : 
                                                            <span className="text-gray-300">—</span>
                                                        }
                                                    </td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">🚗 Prijedlog vozača</h2>
                            <div className="overflow-x-auto px-4 sm:px-0">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-green-50">
                                            <th className="border p-2">Smjer</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2 text-center">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="border p-2 font-bold">Tamo</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2 text-center">
                                                    {assignments[`${p.id}-tamo`] ? (
                                                        <span className={`px-2 py-1 rounded text-sm ${getFamilyColor(assignments[`${p.id}-tamo`])}`}>
                                                            {NAME_MAP.families[assignments[`${p.id}-tamo`]]}
                                                        </span>
                                                    ) : <span className="text-gray-400">—</span>}
                                                </td>
                                            ))}
                                        </tr>
                                        <tr>
                                            <td className="border p-2 font-bold">Nazad</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2 text-center">
                                                    {assignments[`${p.id}-nazad`] ? (
                                                        <span className={`px-2 py-1 rounded text-sm ${getFamilyColor(assignments[`${p.id}-nazad`])}`}>
                                                            {NAME_MAP.families[assignments[`${p.id}-nazad`]]}
                                                        </span>
                                                    ) : <span className="text-gray-400">—</span>}
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h2 className="text-lg font-bold mb-4">👥 Dostupni vozači</h2>
                            <div className="overflow-x-auto px-4 sm:px-0">
                                <table className="w-full border-collapse border">
                                    <thead>
                                        <tr className="bg-gray-50">
                                            <th className="border p-2">Smjer</th>
                                            {practices.map(p => (
                                                <th key={p.id} className="border p-2 text-center">
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{p.time}</div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td className="border p-2 font-bold">Tamo</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {getAvailableDrivers(p.id, 'tamo').map(familyId => (
                                                            <span key={familyId} className={`px-2 py-1 rounded text-xs ${getFamilyColor(familyId)}`}>
                                                                {NAME_MAP.families[familyId]}
                                                            </span>
                                                        ))}
                                                        {getAvailableDrivers(p.id, 'tamo').length === 0 && (
                                                            <span className="text-gray-400 text-xs">Nitko</span>
                                                        )}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                        <tr>
                                            <td className="border p-2 font-bold">Nazad</td>
                                            {practices.map(p => (
                                                <td key={p.id} className="border p-2">
                                                    <div className="flex flex-wrap gap-1">
                                                        {getAvailableDrivers(p.id, 'nazad').map(familyId => (
                                                            <span key={familyId} className={`px-2 py-1 rounded text-xs ${getFamilyColor(familyId)}`}>
                                                                {NAME_MAP.families[familyId]}
                                                            </span>
                                                        ))}
                                                        {getAvailableDrivers(p.id, 'nazad').length === 0 && (
                                                            <span className="text-gray-400 text-xs">Nitko</span>
                                                        )}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="flex gap-4 justify-center flex-wrap">
                            <button onClick={() => setShowResults(false)} className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                ✏️ Uredi Dostupnost
                            </button>
                            <button onClick={resetCurrentWeek} className="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600">
                                🗑️ Reset Tjedan
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-6xl mx-auto p-4 sm:p-6">
                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <div className="flex flex-col gap-4">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h1 className="text-2xl font-bold mb-2">🏀 Tjedni Raspored Treninga</h1>
                                    <p className="text-gray-600">Označite kada dijete dolazi i kada možete voziti</p>
                                    <div className="flex items-center gap-2 mt-2">
                                        <div className="text-lg font-semibold text-blue-600">
                                            Planiram: {formatWeekRange(currentWeekStart)}
                                        </div>
                                        {(() => {
                                            const now = new Date();
                                            const day = now.getDay();
                                            const hour = now.getHours();
                                            if ((day === 6 && hour >= 15) || day === 0) {
                                                return <span className="text-sm bg-green-100 text-green-700 px-2 py-1 rounded">Novi tjedan</span>;
                                            }
                                            return <span className="text-sm bg-blue-100 text-blue-700 px-2 py-1 rounded">Trenutni tjedan</span>;
                                        })()}
                                    </div>
                                </div>
                                <StatusBadge />
                            </div>

                            {lastGenerated && (
                                <p className="text-sm text-green-600">
                                    Zadnji raspored: {new Date(lastGenerated).toLocaleString('hr-HR')}
                                </p>
                            )}
                            
                            {!showResults && (
                                <div className="flex items-center gap-2 text-sm">
                                    <span className="text-gray-600">Obitelji unijele podatke:</span>
                                    <div className="flex gap-1">
                                        {familyIds.map(familyId => {
                                            const hasEntered = practices.some(practice => {
                                                if (isDateInPast(practice.id)) return false;
                                                return isSelected(familyId, practice.id, 'tamo') || 
                                                       isSelected(familyId, practice.id, 'nazad');
                                            });
                                            return (
                                                <span 
                                                    key={familyId} 
                                                    className={`px-2 py-1 rounded text-xs ${
                                                        hasEntered 
                                                            ? getFamilyColor(familyId) 
                                                            : 'bg-gray-200 text-gray-500'
                                                    }`}
                                                >
                                                    {NAME_MAP.families[familyId]}
                                                </span>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-lg font-bold mb-4">👦 Koji dan će dijete ići na trening?</h2>
                        <div className="overflow-x-auto px-4 sm:px-0">
                            <table className="w-full border-collapse border">
                                <thead>
                                    <tr className="bg-blue-50">
                                        <th className="border p-2">Dijete</th>
                                        {practices.map(p => {
                                            const isPast = isDateInPast(p.id);
                                            return (
                                                <th key={p.id} className={`border p-2 text-center ${isPast ? 'bg-gray-200' : ''}`}>
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{isPast ? '(završeno)' : p.time}</div>
                                                </th>
                                            );
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {childrenIds.map(childId => (
                                        <tr key={childId}>
                                            <td className="border p-2 font-bold">{NAME_MAP.children[childId]}</td>
                                            {practices.map(p => {
                                                const isPast = isDateInPast(p.id);
                                                return (
                                                    <td key={p.id} className="border p-2 text-center">
                                                        <input
                                                            type="checkbox"
                                                            checked={isSelected(childId, p.id, 'child')}
                                                            onChange={(e) => {
                                                                e.stopPropagation();
                                                                if (!isPast) toggleSelection(childId, p.id, 'child');
                                                            }}
                                                            disabled={isPast}
                                                            className={`w-5 h-5 ${isPast ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}`}
                                                        />
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 className="text-lg font-bold mb-4">🚗 Kada koja obitelj može voziti?</h2>
                        <div className="overflow-x-auto px-4 sm:px-0">
                            <table className="w-full border-collapse border">
                                <thead>
                                    <tr className="bg-green-50">
                                        <th className="border p-2">Obitelj</th>
                                        {practices.map(p => {
                                            const isPast = isDateInPast(p.id);
                                            return (
                                                <th key={p.id} className={`border p-2 text-center ${isPast ? 'bg-gray-200' : ''}`}>
                                                    <div>{p.day}</div>
                                                    <div className="text-xs">{isPast ? '(završeno)' : p.time}</div>
                                                </th>
                                            );
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {familyIds.map(familyId => (
                                        <tr key={familyId}>
                                            <td className="border p-2 font-bold">{NAME_MAP.families[familyId]}</td>
                                            {practices.map(p => {
                                                const isPast = isDateInPast(p.id);
                                                return (
                                                    <td key={p.id} className="border p-2">
                                                        <div className="flex gap-3 justify-center">
                                                            <label className={`flex flex-col items-center min-h-12 justify-center p-2 rounded ${isPast ? 'cursor-not-allowed opacity-50' : 'cursor-pointer hover:bg-green-50'}`}>
                                                                <span className="text-xs mb-1">tamo</span>
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected(familyId, p.id, 'tamo')}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        if (!isPast) toggleSelection(familyId, p.id, 'tamo');
                                                                    }}
                                                                    disabled={isPast}
                                                                    className={`w-5 h-5 ${isPast ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                                                                />
                                                            </label>
                                                            <label className={`flex flex-col items-center min-h-12 justify-center p-2 rounded ${isPast ? 'cursor-not-allowed opacity-50' : 'cursor-pointer hover:bg-orange-50'}`}>
                                                                <span className="text-xs mb-1">nazad</span>
                                                                <input
                                                                    type="checkbox"
                                                                    checked={isSelected(familyId, p.id, 'nazad')}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        if (!isPast) toggleSelection(familyId, p.id, 'nazad');
                                                                    }}
                                                                    disabled={isPast}
                                                                    className={`w-5 h-5 ${isPast ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                                                                />
                                                            </label>
                                                        </div>
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {hasEnoughData() && !showResults && (
                        <div className="text-center mt-6">
                            <button 
                                onClick={generateAssignments}
                                className="px-8 py-4 rounded-lg font-bold text-xl bg-green-600 text-white hover:bg-green-700 shadow-lg transform hover:scale-105 transition-all"
                            >
                                ✅ Gotovo - Generiraj Raspored Prijevoza
                            </button>
                            <p className="text-sm text-gray-600 mt-2">
                                Kliknite kada ste završili sa unosom dostupnosti
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<CarpoolApp />, document.getElementById('root'));
    </script>
</body>
</html>
